<script>
    function formatNumber(num) {
        if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
        if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
        if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
        if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
        return num.toFixed(2);
    }

    function parseInput(value) {
        value = value.trim().toUpperCase();

        // Remove commas if they exist
        value = value.replace(/,/g, '');

        // Match numeric part and suffix (K, M, B, T) with optional decimal
        const regex = /^(\d*\.?\d+)([KMBT])?$/;
        const match = value.match(regex);

        if (match) {
            let number = parseFloat(match[1]);
            let multiplier = 1;

            if (match[2] === 'T') multiplier = 1e12;
            else if (match[2] === 'B') multiplier = 1e9;
            else if (match[2] === 'M') multiplier = 1e6;
            else if (match[2] === 'K') multiplier = 1e3;

            return number * multiplier;
        }

        return 0;  // Default if the input does not match
    }

    function autoComplete(input) {
        let rawValue = input.value;
        let numericValue = parseInput(rawValue);
        
        if (numericValue) {
            input.value = numericValue.toLocaleString();  // Format number with commas
        }
    }

    function handleInput(input) {
        let rawValue = input.value.trim().toUpperCase();

        // Autocomplete immediately after input
        if (rawValue.match(/^(\d+(\.\d+)?)([KMBT])?$/)) {
            autoComplete(input);
        }
    }

    function calculateProfit() {
        let moneyInvested = parseInput(document.getElementById('moneyInvested').value);
        let sharePrice = parseInput(document.getElementById('sharePrice').value);
        let sellPrice = parseInput(document.getElementById('sellPrice').value);

        if (!moneyInvested || !sharePrice || !sellPrice) {
            alert("Please enter valid numbers.");
            return;
        }

        let totalInvested = moneyInvested;

        // Fee per share is 0.1% of the selling price
        let feePerShare = sellPrice * 0.001;

        // Calculate how many shares you can buy
        let sharesBought = moneyInvested / sharePrice;

        // Total transaction fee for all shares sold
        let totalFee = feePerShare * sharesBought;

        // Final selling price per share after fee
        let finalSellPrice = sellPrice - feePerShare;

        // Total amount from selling all shares
        let totalSold = sharesBought * finalSellPrice;

        // Profit is the total amount from selling minus the total invested
        let profit = totalSold - totalInvested;

        // ROI calculation: profit divided by the total invested, times 100 to get percentage
        let roi = (profit / totalInvested) * 100;

        // Update the results section with the calculations
        document.getElementById('totalInvested').textContent = `$${formatNumber(totalInvested)}`;
        document.getElementById('investedAmount').textContent = formatNumber(moneyInvested);
        document.getElementById('boughtPrice').textContent = `$${formatNumber(sharePrice)}`;
        document.getElementById('fee').textContent = `${formatNumber(feePerShare)} per share`;
        document.getElementById('soldShares').textContent = formatNumber(sharesBought);
        document.getElementById('soldPrice').textContent = `$${formatNumber(finalSellPrice)}`;
        document.getElementById('profit').textContent = `$${formatNumber(profit)}`;
        document.getElementById('roi').textContent = `${roi.toFixed(2)}%`;

        // Adjust the colors for profit/loss and ROI
        document.getElementById('profit').className = profit >= 0 ? 'text-green-500' : 'text-red-500';
        document.getElementById('roi').className = profit >= 0 ? 'text-green-500' : 'text-red-500';

        // Show the results section
        document.getElementById('result').classList.remove('hidden');
    }
</script>